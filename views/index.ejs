<!DOCTYPE html>
<html>

<head>
  <title>Socket.IO chat</title>
  <link rel="stylesheet" type="text/css" href="./style.css" />
  <link rel="stylesheet" href="./xterm/css/xterm.css" />
</head>

<body>
  <div id="terminal-container"></div>
  <script src="./xterm/lib/xterm.js"></script>
  <script src="./addon-fit/lib/addon-fit.js"></script>
  <script src="./addon-web-links/lib/addon-web-links.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const terminalContainer = document.getElementById('terminal-container');
      const term = new Terminal({
        cursorBlink: true,


      });

      const fitAddon = new FitAddon.FitAddon();
      term.loadAddon(fitAddon);
      term.open(terminalContainer);
      fitAddon.fit();

      window.addEventListener('resize', () => fitAddon.fit());

      const socket = io("/admin");
      const room = "default-room"; // Default single room

      socket.on("connect", () => {
        socket.emit("join", { room: room });

      });

      socket.on("chat message", (msg) => {
        term.writeln(msg);
        term.scrollToBottom();
      });

      term.onKey((e) => {
        const char = e.key;
        if (char === '\r') {  // Enter key
          const input = term.buffer.active.getLine(term.buffer.active.cursorY).translateToString(true).trim();
          if (input.length > 0) {
            socket.emit("chat message", { room: room, username: "User", msg: input });
            term.write('\r\n');
          }
        } else {
          term.write(char);
        }
      });

      term.focus();
    });
  </script>
</body>

</html>